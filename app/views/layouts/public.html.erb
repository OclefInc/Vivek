<!DOCTYPE html>
<html>
  <head>
    <%= render "shared/google_analytics" %>
    <title><%= content_for(:title) || "The Vivek Project" %></title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="<%= request.original_url %>">
    <meta property="og:title" content="<%= content_for(:title) || "The Vivek Project" %>">
    <meta property="og:description" content="<%= content_for(:meta_description) || "The Vivek Project is a free service provided by the Oclef Foundation, dedicated to documenting piano pedagogy on video. Our mission is to illuminate the teaching and learning process that has remained hidden for far too long." %>">
    <meta property="og:image" content="<%= content_for(:meta_image) || image_url("social_share.png") %>">
    <meta property="og:site_name" content="The Vivek Project">
    <!-- Google / Search Engine Tags -->
    <meta itemprop="name" content="<%= content_for(:title) || "The Vivek Project" %>">
    <meta itemprop="description" content="<%= content_for(:meta_description) || "The Vivek Project is a free service provided by the Oclef Foundation, dedicated to documenting piano pedagogy on video. Our mission is to illuminate the teaching and learning process that has remained hidden for far too long." %>">
    <meta itemprop="image" content="<%= content_for(:meta_image) || image_url("social_share.png") %>">
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="<%= request.original_url %>">
    <meta property="twitter:title" content="<%= content_for(:title) || "The Vivek Project" %>">
    <meta property="twitter:description" content="<%= content_for(:meta_description) || "A platform for music education projects." %>">
    <meta property="twitter:image" content="<%= content_for(:meta_image) || image_url("social_share.png") %>">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>
    <%= yield :head %>
    <%# Enable PWA manifest for installable apps (make sure to enable in config/routes.rb too!) %>
    <%#= tag.link rel: "manifest", href: pwa_manifest_path(format: :json) %>
    <%= favicon_link_tag "favi.png" %>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap" rel="stylesheet">
    <%# Includes all stylesheet files in app/assets/stylesheets %>
    <%= stylesheet_link_tag "tailwind", "data-turbo-track": "reload" %>
    <%= stylesheet_link_tag "actiontext", "data-turbo-track": "reload" %>
    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tom-select@2.3.1/dist/css/tom-select.default.min.css">
    <script src="https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/build/pdf.min.js"></script>
    <%= javascript_importmap_tags 'application' %>
  </head>
  <body class="bg-slate-50 dark:bg-gray-900 flex flex-col min-h-screen" style="font-family: 'Inter', sans-serif;" data-controller="sidebar">
    <!-- Header -->
    <header class="bg-gradient-to-r from-indigo-800 to-teal-500 text-white border-b border-teal-600 sticky top-0 z-50">
      <div class="container mx-auto px-4 py-4">
        <div class="flex items-center justify-between">
          <!-- Logo/Brand -->
          <div class="flex items-center gap-3">
            <%= image_tag "favicon.svg", alt: "Oclef", class: "h-8 w-auto" %>
            <%= link_to "The Vivek Project", root_path, class: "text-xl font-medium text-white hover:text-teal-200" %>
          </div>
          <!-- Desktop Navigation -->
          <nav class="hidden xl:flex items-center gap-6">
            <%= form_with url: projects_path, method: :get, class: "relative" do |form| %>
              <%= form.text_field :query, value: params[:query], placeholder: "Search projects...", class: "bg-white/10 text-white placeholder-teal-200/70 border-none rounded-full py-1.5 px-4 pl-10 focus:ring-2 focus:ring-teal-300 text-sm w-64" %>
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 text-teal-200">
                <path stroke-linecap="round" stroke-linejoin="round" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z" />
              </svg>
            <% end %>
            <%= link_to "About", about_path, class: "text-teal-200 hover:text-white px-3 py-2 rounded-lg transition-colors #{request.path == about_path ? 'bg-white/10' : ''}" %>
            <%= link_to "Project Types", public_project_types_path, class: "text-teal-200 hover:text-white px-3 py-2 rounded-lg transition-colors #{request.path == public_project_types_path ? 'bg-white/10' : ''}" %>
            <%= link_to "Contributors", contributors_path, class: "text-teal-200 hover:text-white px-3 py-2 rounded-lg transition-colors #{request.path == contributors_path ? 'bg-white/10' : ''}" %>
            <%= link_to "Contact", contact_path, class: "text-teal-200 hover:text-white px-3 py-2 rounded-lg transition-colors #{request.path == contact_path ? 'bg-white/10' : ''}" %>
            <% if user_signed_in? %>
              <!-- User dropdown -->
              <div class="relative" data-controller="dropdown">
                <button data-action="click->dropdown#toggle click@window->dropdown#hide"
                  class="inline-flex items-center gap-2border-lime-600  py-2 px-4 hover:border-teal-600 rounded-xl text-black transition-all">
                  <div class="rounded-full overflow-hidden w-6 h-6 ">
                    <% if current_user.avatar.attached? %>
                      <%= image_tag current_user.cropped_avatar(size: 48), class: "w-6 h-6 rounded-full object-cover" %>
                    <% elsif current_user.picture_url.present? %>
                      <%= image_tag current_user.picture_url, class: "w-6 h-6 rounded-full object-cover" %>
                    <% else %>
                      <div class="w-full h-full bg-gradient-to-br from-blue-400 to-purple-500 flex items-center justify-center">
                        <span class="text-white text-xs"><%= current_user.initials&.upcase || current_user.email&.first&.upcase %></span>
                      </div>
                    <% end %>
                  </div>
                  <svg class="w-4 h-4 text-gray-700 dark:text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                  </svg>
                </button>
                <div data-dropdown-target="menu"
                     class="hidden absolute right-0 mt-2 w-48 rounded-lg shadow-lg bg-white dark:bg-gray-800 ring-1 ring-black ring-opacity-5 overflow-hidden">
                  <div class="py-1">
                    <% if current_user.is_employee? %>
                      <%= link_to admin_path, class: "block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center" do %>
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4 mr-2">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75 11.25 15 15 9.75M21 12c0 1.268-.63 2.39-1.593 3.068a3.745 3.745 0 0 1-1.043 3.296 3.745 3.745 0 0 1-3.296 1.043A3.745 3.745 0 0 1 12 21c-1.268 0-2.39-.63-3.068-1.593a3.746 3.746 0 0 1-3.296-1.043 3.745 3.745 0 0 1-1.043-3.296A3.745 3.745 0 0 1 3 12c0-1.268.63-2.39 1.593-3.068a3.745 3.745 0 0 1 1.043-3.296 3.746 3.746 0 0 1 3.296-1.043A3.746 3.746 0 0 1 12 3c1.268 0 2.39.63 3.068 1.593a3.746 3.746 0 0 1 3.296 1.043 3.746 3.746 0 0 1 1.043 3.296A3.745 3.745 0 0 1 21 12Z" />
                        </svg>
                        Admin
                      <% end %>
                    <% end %>
                    <%= link_to edit_user_registration_path, class: "block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center" do %>
                      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4 mr-2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M17.982 18.725A7.488 7.488 0 0 0 12 15.75a7.488 7.488 0 0 0-5.982 2.975m11.963 0a9 9 0 1 0-11.963 0m11.963 0A8.966 8.966 0 0 1 12 21a8.966 8.966 0 0 1-5.982-2.275M15 9.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
                      </svg>
                      Account
                    <% end %>
                    <%= link_to subscriptions_path, class: "block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center" do %>
                      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4 mr-2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M14.857 17.082a23.848 23.848 0 0 0 5.454-1.31A8.967 8.967 0 0 1 18 9.75V9A6 6 0 0 0 6 9v.75a8.967 8.967 0 0 1-2.31 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 0 1-5.714 0m5.714 0a3 3 0 1 1-5.714 0" />
                      </svg>
                      Subscriptions
                    <% end %>
                    <%= link_to public_bookmarks_path, class: "block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center" do %>
                      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4 mr-2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M17.593 3.322c1.1.128 1.907 1.077 1.907 2.185V21L12 17.25 4.5 21V5.507c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 0 1 11.186 0Z" />
                      </svg>
                      Bookmarks
                    <% end %>
                    <%= button_to destroy_user_session_path, method: :delete, class: "w-full text-left px-4 py-2 text-sm text-red-600 dark:text-red-400 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center" do %>
                      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4 mr-2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 9V5.25A2.25 2.25 0 0 0 13.5 3h-6a2.25 2.25 0 0 0-2.25 2.25v13.5A2.25 2.25 0 0 0 7.5 21h6a2.25 2.25 0 0 0 2.25-2.25V15m3 0 3-3m0 0-3-3m3 3H9" />
                      </svg>
                      Log out
                    <% end %>
                  </div>
                </div>
              </div>
            <% else %>
              <%= link_to new_user_session_path, class: "text-teal-200 hover:text-white px-3 py-2 rounded-lg transition-colors #{request.path == new_user_session_path ? 'bg-white/10' : ''}" do %>
                Login
              <% end %>
            <% end %>
          </nav>
          <!-- Mobile menu button -->
          <button data-action="click->sidebar#toggle" class="xl:hidden p-2 rounded-lg hover:bg-white/10">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
            </svg>
          </button>
        </div>
      </div>
    </header>
    <%= render '/layouts/mobile_menu' %>
    <!-- Main content area -->
    <main class="px-2 py-4 md:px-10 md:py-10">
      <div class="flex flex-col items-center max-w-7xl mx-auto ">
        <p style="color: green"><%= notice.html_safe if notice %></p>
      </div>
      <%= yield %>
    </main>
  </body>
</html>
