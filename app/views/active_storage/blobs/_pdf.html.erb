<!-- Pages selector (attachment-level, specific to this instance) -->
<div data-controller="pdf-viewer"
     data-pdf-viewer-url-value="<%= url_for(blob) %>"
     data-pdf-viewer-copyrighted-value="<%= is_copyrighted %>"
     data-pdf-viewer-pages-value="<%= attachment.pages %>"
  class="relative inline-block w-full">
  <!-- PDF.js viewer container -->
  <div class="bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-600 overflow-auto"
       style="max-height: 800px; <%= is_copyrighted ? 'user-select: none;' : '' %>">
    <!-- PDF pages will be rendered here as canvas elements -->
  </div>
</div>
<% display_all_pages = attachment.pages.blank? %>
<div data-copyright-banner class="mt-3 p-3 bg-amber-50 border border-amber-200">
  <div class="flex justify-between items-start gap-2">
    <% if is_copyrighted %>
      <p class="text-sm font-medium text-amber-800">Copyrighted Material</p>
      <p class="text-sm font-medium text-amber-800">
        Pages:
        <span id="pages-display">
          <%= display_all_pages ? "All" : attachment.pages %>
        </span>
      </p>
      <% if purchase_url.present? %>
        <p class="text-sm text-amber-700 mt-1">
          Purchase:
          <%= link_to "Click Here", purchase_url,
                target: "_blank",
                rel: "noopener noreferrer",
                class: "text-blue-600 hover:text-blue-800 underline font-medium" %>
        </p>
      <% end %>
    <% else %>
      <p class="text-sm font-medium text-amber-800">Non Copyrighted Material</p>
      <p class="text-sm font-medium text-amber-800">
        Pages:
        <span id="pages-display">
          <%= display_all_pages ? "All" : attachment.pages %>
        </span>
      </p>
      <p class="text-sm text-amber-700 mt-1">
        Download:
        <%= link_to "Click Here", rails_blob_path(blob, disposition: "attachment"),
                target: "_blank",
                rel: "noopener noreferrer",
                class: "text-blue-600 hover:text-blue-800 underline font-medium" %>
      </p>
    <% end %>
  </div>
</div>
<div class="admin-only mt-2 p-3 bg-blue-50 dark:bg-blue-900/20"
         data-controller="attachment-pages blob-metadata"
         data-pages="<%= attachment.pages %>"
         data-blob-sgid="<%= blob.signed_id %>">
  <div class="flex items-between justify-center gap-4 mb-2">
    <button data-action="click->blob-metadata#toggleEdit"
      data-blob-metadata-target="editButton"
      class="text-xs px-2 py-1 text-white">
      Edit Copyright Information
    </button>
    <button data-action="click->attachment-pages#toggleEdit"
      data-attachment-pages-target="editButton"
      class="text-xs px-2 py-1 text-white">
      Edit Pages to Display
    </button>
  </div>
  <!-- Edit Form -->
  <div data-attachment-pages-target="editForm" class="hidden">
    <div class="space-y-3" style="padding: 10px;">
      <div style="padding: 10px;">
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1">
          Pages to display:
          <span class="text-xs text-gray-500">(e.g., "2-9, 11, 14" or leave empty for all)</span>
        </label>
        <input type="text"
                 data-attachment-pages-target="pagesInput"
                 placeholder="e.g., 2-9, 11, 14"
                 class="w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-800 dark:text-gray-200">
      </div>
      <div class="flex gap-2" style="padding: 10px;">
        <button type="button"
              data-action="click->attachment-pages#save"
          class="px-3 py-1 text-sm bg-blue-600 hover:bg-blue-500 text-white rounded" style="padding:3px">
          Save
        </button>
        <button type="button"
              data-action="click->attachment-pages#cancel"
          class="px-3 py-1 text-sm bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-200 rounded" style="padding:3px">
          Cancel
        </button>
      </div>
    </div>
  </div>
  <!-- Copyright metadata editor (blob-level, shared across all attachments) -->
  <!-- View Mode -->
  <div data-blob-metadata-target="viewMode">
  </div>
  <!-- Edit Mode -->
  <div data-blob-metadata-target="editMode" class="hidden">
    <div class="space-y-3" style="padding: 10px;">
      <div class="flex items-center gap-2" style="padding: 10px;">
        <input type="checkbox"
                 data-blob-metadata-target="copyrightCheckbox"
                 <%= 'checked' if is_copyrighted %>
                 class="w-4 h-4 text-blue-600 bg-gray-100 dark:bg-gray-700 border-gray-300 dark:border-gray-600 rounded focus:ring-blue-500">
        <label class="text-sm font-medium text-gray-700 dark:text-gray-200">This attachment is copyrighted</label>
      </div>
      <div style="padding: 10px;">
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1">
          Purchase Link: <span class="text-red-600">*</span>
          <span class="text-xs text-gray-500">(required if copyrighted)</span>
        </label>
        <input type="text"
                 data-blob-metadata-target="purchaseUrlInput"
                 value="<%= purchase_url %>"
                 placeholder="https://www.amazon.com/..."
                 class="w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-800 dark:text-gray-200">
      </div>
      <div class="flex gap-2"  style="padding: 10px;">
        <button data-action="click->blob-metadata#save"
          data-blob-sgid="<%= blob.signed_id %>"
          class="px-3 py-1 text-sm bg-blue-600 hover:bg-blue-500 text-white rounded" style="padding:3px">
          Save
        </button>
        <button data-action="click->blob-metadata#cancel"
          class="px-3 py-1 text-sm bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-200 rounded" " style="padding:3px">
          Cancel
        </button>
      </div>
    </div>
  </div>
</div>
</div>