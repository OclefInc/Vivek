<% content_for :title, 'Assignment' %>
<p style="color: green"><%= notice %></p>
<div class="flex justify-between items-center">
  <span class="px-2 py-1 font-bold text-2xl"><%= @assignment.composition.name %></span>
  <div class="ml-2 flex items-center justify-end gap-1">
    <%= link_to "Edit", edit_assignment_path(@assignment), class: "sm:w-auto text-center rounded-lg px-3 py-2 m-1 bg-gray-100 hover:bg-gray-50 inline-block font-medium" %>
    <%= button_to "Delete", @assignment, method: :delete, class: "sm:w-auto rounded-lg px-3 py-2 m-1 text-white bg-red-600 hover:bg-red-500 font-medium cursor-pointer", data: { turbo_confirm: "Delete entire assignment; Are you sure?" } if @assignment.lessons.empty? %>
  </div>
</div>
<div class=" lg:flex md:-mx-5 py-4">
  <div class="md:flex-1 md:basis-1/2 md:px-5">
    <% if @assignment.summary_video.attached? %>
      <div class="bg-black flex items-center justify-center" style="width: 640px; height: 480px; max-width: 100%;">
        <% if @assignment.summary_video.attached? %>
          <%= video_tag @assignment.summary_video,
          controls: true,
          style: "max-width: 100%; max-height: 100%;",
          class: "max-w-full h-auto",
          data: {
            controller: "video-autoplay",
            video_autoplay_next_url_value: @assignment.first_lesson ? lesson_path(@assignment.first_lesson) : nil
          } %>
        <% end %>
      </div>
    <% end %>
    <%= render @assignment %>
  </div>
  <div class="w-full md:flex-1 md:basis-1/2 md:px-5">
    <%= form_with(model: @assignment.lessons.build) do |form| %>
      <div class="dropzone dropzone-default dz-clickable" data-controller="dropzone" data-dropzone-max-file-size="10000000" data-dropzone-accepted-files="video/*" data-turbo-permanent>
        <%= form.file_field :lesson_video, direct_upload: true, data: { 'dropzone-target': "input", 'dropzone-capture-mode-value': 'environment', autosubmit: true, turbosubmit: nil, camera: false } %>
        <div class="dropzone-msg dz-message needsclick">
          <h3 class="dropzone-msg-title">Drag Video Lesson File Here</h3>
          <span class="dropzone-msg-desc">Click To Browse</span>
        </div>
      </div>
      <%= form.hidden_field :assignment_id %>
      <%= form.submit class: "w-full sm:w-auto rounded-lg my-2 px-3 py-2 bg-blue-600 hover:bg-blue-400 text-white inline-block font-medium cursor-pointer" %>
    <% end %>
    <%= render partial: 'lesson_table', locals: { lessons: @assignment.lessons } %>
  </div>
</div>
