<div  id="<%= dom_id @project %>" class="w-full" style="max-width: 640px; ">
  <div style="aspect-ratio: 4/3;">
    <% if @project.summary_video.attached? %>
      <div class=" w-full relative bg-black group" style="max-width: 640px; aspect-ratio: 4/3;" data-controller="video-poster video-player">
        <%= video_tag @project.summary_video, id: "lesson-video", style: "width: 100%; height: 100%; object-fit: contain;", controls: false, preload: "metadata", data: { video_poster_target: "video", video_player_target: "video", action: "click->video-player#togglePlay" } %>
        <div data-video-poster-target="overlay" class="absolute inset-0 flex flex-col items-center justify-center pointer-events-none bg-black">
          <h2 class="text-white text-3xl font-bold text-center px-8"><%= @project.project_name %></h2>
          <p class="text-gray-300 text-xl mt-3"><%= @project.student&.name %></p>
          <% if @project.lessons.any? %>
            <p class="text-gray-400 text-lg mt-2">
              <%= @project.lessons.minimum(:date)&.strftime("%b %d, %Y") %> - <%= @project.lessons.maximum(:date)&.strftime("%b %d, %Y") %>
            </p>
            <p class="text-gray-400 text-lg mt-1">
              <%= @project.lessons.count %> <%= 'Lesson'.pluralize(@project.lessons.count) %>
            </p>
          <% end %>
        </div>
        <%= render 'shared/video_player_controls' %>
      </div>
    <% elsif @project.summary_video_url.present? %>
      <div class="w-full relative bg-black group" style="max-width: 640px; aspect-ratio: 4/3;" data-controller="video-poster">
        <iframe
          width="100%"
          height="100%"
          src="https://www.youtube.com/embed/<%= @project.youtube_video_id %>"
          frameborder="0"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
          allowfullscreen
          class="w-full h-full"
          data-video-poster-target="video">
        </iframe>
        <div data-video-poster-target="overlay" data-action="click->video-poster#hideOverlay" class="absolute inset-0 flex flex-col items-center justify-center bg-black cursor-pointer">
          <h2 class="text-white text-3xl font-bold text-center px-8"><%= @project.project_name %></h2>
          <p class="text-gray-300 text-xl mt-3"><%= @project.student&.name %></p>
          <% if @project.lessons.any? %>
            <p class="text-gray-400 text-lg mt-2">
              <%= @project.lessons.minimum(:date)&.strftime("%b %d, %Y") %> - <%= @project.lessons.maximum(:date)&.strftime("%b %d, %Y") %>
            </p>
            <p class="text-gray-400 text-lg mt-1">
              <%= @project.lessons.count %> <%= 'Lesson'.pluralize(@project.lessons.count) %>
            </p>
          <% end %>
        </div>
      </div>
    <% else %>
      <div class="lg:min-w-[640px] lg:max-w-[640px] w-full relative bg-black group" style=" aspect-ratio: 4/3;">
        <% first_lesson = @project.lessons.order(:sort).first %>
        <% if first_lesson %>
          <%= link_to project_episode_path(@project, first_lesson, {autoplay: true}), class: "block w-full relative bg-black group", style: "max-width: 640px; aspect-ratio: 4/3;" do %>
            <div class="absolute inset-0 flex flex-col items-center justify-center bg-black">
              <h2 class="text-white text-3xl font-bold text-center px-8"><%= @project.project_name %></h2>
              <p class="text-gray-300 text-xl mt-3"><%= @project.student&.name %></p>
              <% if @project.lessons.any? %>
                <p class="text-gray-400 text-lg mt-2">
                  <%= @project.lessons.minimum(:date)&.strftime("%b %d, %Y") %> - <%= @project.lessons.maximum(:date)&.strftime("%b %d, %Y") %>
                </p>
                <p class="text-gray-400 text-lg mt-1">
                  <%= @project.lessons.count %> <%= 'Lesson'.pluralize(@project.lessons.count) %>
                </p>
              <% end %>
              <div class="mt-8 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                <span class="px-6 py-3 bg-white/10 hover:bg-white/20 backdrop-blur-sm border border-white/20 rounded-full text-white font-medium flex items-center gap-2">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5">
                    <path fill-rule="evenodd" d="M4.5 5.653c0-1.426 1.529-2.33 2.779-1.643l11.54 6.348c1.295.712 1.295 2.573 0 3.285L7.28 19.991c-1.25.687-2.779-.217-2.779-1.643V5.653z" clip-rule="evenodd" />
                  </svg>
                  Play First Lesson
                </span>
              </div>
            </div>
          <% end %>
        <% else %>
          <div class="bg-gray-200 dark:bg-zinc-700 p-2 rounded-2xl flex items-center justify-center w-full" style="aspect-ratio: 4/3;">
            <span class="text-gray-500 dark:text-gray-400 text-lg">No summary video available</span>
          </div>
        <% end %>
      </div>
    <% end %>
  </div>
  <div class="bg-gray-800 text-white p-4">
    <div class="flex justify-between items-center">
      <% if @project.project_type %>
        <div class="flex items-center gap-2">
          <strong class="font-semibold text-white">Type:</strong>
          <span><%= link_to(@project.project_type.name, public_project_type_path(@project.project_type), class:'text-indigo-300 hover:text-indigo-200') %></span>
        </div>
      <% end %>
      <div class="flex items-center gap-2">
        <span><%= "Teacher".pluralize(@project.teachers.uniq.count) %>:</span>
        <% @project.teachers.uniq.each do |teacher| %>
          <% if teacher.display_avatar(size: 24) %>
            <%= link_to professor_path(teacher) , title: "#{teacher.name}" do %>
              <%= image_tag teacher.display_avatar(size: 24), class: "w-6 h-6 rounded-full object-cover border border-gray-200 dark:border-gray-700" %>
            <% end %>
          <% else %>
            <%= link_to teacher.name, professor_path(teacher), class:'text-indigo-300 hover:text-indigo-200' %>
          <% end %>
        <% end %>
      </div>
    </div>
    <h3 class="text-lg font-semibold mt-4">About This Project:</h3>
    <%= @project.description %>
    <div class="mt-4 flex items-center justify-between">
      <%= render 'shared/share_buttons' %>
      <%= turbo_frame_tag "bookmark_button_#{dom_id(@project)}", src: button_public_bookmarks_path(bookmarkable_id: @project.id, bookmarkable_type: @project.class.name), class: "flex items-center" %>
    </div>
  </div>
</div>