<div id="<%= dom_id @episode %>" class="" style="max-width: 640px; ">
  <% if @episode.lesson_video.attached? %>
    <div style="aspect-ratio: 4/3;">
      <div class=" w-full relative bg-black group" style="max-width: 640px; aspect-ratio: 4/3;" data-controller="video-poster video-player">
        <%= video_tag @episode.lesson_video, id: "lesson-video", style: "width: 100%; height: 100%; object-fit: contain;", controls: false, autoplay: true, preload: "metadata", data: {
              video_poster_target: "video",
              video_player_target: "video",
              action: "click->video-player#togglePlay",
              controller: "video-autoplay",
              video_autoplay_next_url_value: (@episode.next_lesson ? project_episode_path(@episode.project, @episode.next_lesson) : nil),
              video_autoplay_next_name_value: @episode.next_lesson&.name,
              video_autoplay_next_date_value: @episode.next_lesson&.date&.strftime("%B %d, %Y")
            } %>
        <div data-video-poster-target="overlay" class="absolute inset-0 flex flex-col items-center justify-center pointer-events-none bg-black">
          <h2 class="text-white text-3xl font-bold text-center px-8"><%= @episode.name %></h2>
          <p class="text-gray-400 text-xl mt-4"><%= @episode.date.strftime("%B %d, %Y") %></p>
        </div>
        <!-- Custom Controls -->
        <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/90 via-black/60 to-transparent px-4 pb-4 pt-8 opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex flex-col gap-2 z-10"
             data-video-player-target="controls">
          <!-- Progress Bar Container -->
          <div class="relative h-1.5 bg-gray-600/50 rounded cursor-pointer group/progress hover:h-2 transition-all"
               data-video-player-target="progressContainer"
               data-action="click->video-player#seek mousemove->video-player#showThumbnail mouseleave->video-player#hideThumbnail">
            <!-- Progress Bar -->
            <div class="absolute top-0 left-0 h-full bg-blue-500 rounded pointer-events-none"
                 data-video-player-target="progressBar"
                 style="width: 0%"></div>
            <!-- Thumbnail Tooltip -->
            <div class="absolute bottom-6 hidden pointer-events-none bg-black border border-gray-700 rounded shadow-lg overflow-hidden w-32 aspect-video z-50"
                 data-video-player-target="thumbnailTooltip">
              <video class="w-full h-full object-cover"
                     muted
                     preload="metadata"
                     data-video-player-target="thumbnailVideo"></video>
            </div>
          </div>
          <!-- Buttons & Time -->
          <div class="flex items-center justify-between text-white">
            <div class="flex items-center gap-4">
              <button data-action="video-player#togglePlay" class="hover:text-blue-400 transition-colors">
                <!-- Play Icon -->
                <svg data-video-player-target="playButton" class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                <!-- Pause Icon -->
                <svg data-video-player-target="pauseButton" class="w-6 h-6 hidden" fill="currentColor" viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
              </button>
              <span data-video-player-target="timeDisplay" class="text-xs font-mono text-gray-300">0:00 / 0:00</span>
            </div>
            <button data-action="video-player#toggleFullscreen" class="hover:text-blue-400 transition-colors">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"></path>
              </svg>
            </button>
          </div>
        </div>
      </div>
    </div>
  <% end %>
  <div class="bg-gray-800 p-4 text-white" data-controller="pdf-toggle">
    <%# Tailwind classes used in JS controller %>
    <div class="hidden text-blue-400 hover:text-blue-300 underline font-medium transition-colors"></div>
    <div class="flex justify-between  items-center gap-2">
      <h3 class="text-lg font-semibold">Lesson Notes and Music</h3>
      <div class="flex items-center gap-2">
        <span>Teacher:</span>
        <% if @episode.teacher.display_avatar(size: 24) %>
          <%= link_to professor_path(@episode.teacher) , title: "#{@episode.teacher.name}" do %>
            <%= image_tag @episode.teacher.display_avatar(size: 24), class: "w-6 h-6 rounded-full object-cover border border-gray-200 dark:border-gray-700" %>
          <% end %>
        <% else %>
          <%= link_to @episode.teacher.name, professor_path(@episode.teacher), class:'text-indigo-300 hover:text-indigo-200' %>
        <% end %>
      </div>
    </div>
    <div class="mt-4">
      <%= render 'chapter_list', episode: @episode %>
    </div>
    <%= @episode.description %>
    <div class="mt-4 flex items-center justify-between">
      <%= render 'shared/share_buttons' %>
      <%= turbo_frame_tag "bookmark_button_#{dom_id(@episode)}", src: button_public_bookmarks_path(bookmarkable_id: @episode.id, bookmarkable_type: @episode.class.name), class: "flex items-center" %>
    </div>
    <div class="xl:hidden mt-5">
      <%= render '/public/projects/episode_dropdown', episode: @episode, project: @episode.project %>
    </div>
  </div>
</div>