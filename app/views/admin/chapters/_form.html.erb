<%# app/views/chapters/_form.html.erb %>
<div class="">
  <%= form_with(model: [lesson, chapter],
                  data: { controller: "video-chapters",
                          video_chapters_target: "form" }) do |form| %>
    <div class="mb-3">
      <%= form.label :name, "Chapter Name", class: "block text-sm mb-1" %>
      <%= form.text_field :name,
            class: "w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white",
            placeholder: "e.g., Introduction",
            data: { video_chapters_target: "nameInput" } %>
    </div>
    <div class="mb-3">
      <div class="flex justify-between items-center mb-1">
        <%= form.label :start_time, "Start Time (seconds)", class: "block text-sm" %>
        <% if lesson.lesson_video.attached? %>
          <button type="button"
                    data-action="click->video-chapters#captureCurrentTime"
            class="px-2 py-1 bg-blue-600 hover:bg-blue-500 rounded text-xs">
            Use Current Time
          </button>
        <% end %>
      </div>
      <%= form.number_field :start_time,
            class: "w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white",
            min: 0,
            data: { video_chapters_target: "startTimeInput" } %>
    </div>
    <div class="mb-3">
      <%= form.label :tutorial_ids, "Add to Tutorials", class: "block text-sm mb-1" %>
      <%= form.select :tutorial_ids,
            options_for_select(chapter.tutorials.map { |t| [t.name, t.id] }, chapter.tutorial_ids),
            {},
            { multiple: true, class: "w-full bg-gray-800 rounded-lg text-white outline-none", data: { controller: "multi-select", multi_select_placeholder_value: "Select one or more tutorials...", multi_select_teacher_id_value: lesson.teacher_id, multi_select_endpoint_value: "tutorials" } } %>
    </div>
    <div class="flex gap-2 justify-center">
      <%= form.submit "Save Chapter",
            class: "px-3 py-1 bg-blue-600 hover:bg-blue-500 rounded-lg font-medium text-sm" %>
      <%= link_to "Cancel", lesson_path(lesson),
            class: "px-3 py-1 bg-gray-600 hover:bg-gray-500 rounded-lg font-medium text-sm"%>
    </div>
  <% end %>
</div>