<% cache tutorial do %>
  <%= link_to tutorial_path(tutorial), class: "block" do %>
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden hover:shadow-xl transition-shadow duration-300">
      <!-- Header Section with Animated Chapter Names Background -->
      <div class="group relative bg-gradient-to-br from-purple-400 to-indigo-500 dark:from-gray-600 dark:to-gray-700 flex flex-col items-center justify-center py-4 md:py-8 overflow-hidden" style="aspect-ratio: 1 / 1;">
        <!-- Video (shown on hover) -->
        <% if tutorial.video_file.attached? %>
          <div class="absolute inset-0 bg-black transition-opacity duration-300 z-20"
               data-controller="video-hover"
               data-video-hover-target="videoContainer">
            <%= video_tag tutorial.video_file,
                    autoplay: false,
                    muted: true,
                    loop: true,
                    preload: "none",
                    playsinline: true,
                    class: "w-full h-full object-cover",
                    data: { video_hover_target: "video" } %>
            <!-- Progress Bar -->
            <div data-video-hover-target="progressContainer"
                 data-action="click->video-hover#seekVideo:stop mousemove->video-hover#showTime:stop mouseleave->video-hover#hideTime:stop"
              class="absolute bottom-0 left-0 right-0 h-1 bg-white/20 z-30 cursor-pointer hover:h-2 transition-all">
              <div data-video-hover-target="progressBar" class="h-full bg-white transition-all duration-100" style="width: 0%"></div>
              <!-- Time tooltip -->
              <div data-video-hover-target="timeTooltip" class="hidden absolute bottom-full mb-1 bg-black/80 text-white text-xs px-2 py-1 rounded pointer-events-none whitespace-nowrap"></div>
            </div>
            <!-- Mute/Unmute Button -->
            <button type="button"
                  data-action="click->video-hover#toggleMute:stop"
              data-video-hover-target="muteButton"
              class="absolute bottom-4 right-4 bg-white/80 dark:bg-gray-800/80 hover:bg-white dark:hover:bg-gray-700 rounded-full p-2 shadow-lg transition-colors z-30">
              <svg data-video-hover-target="mutedIcon" class="w-6 h-6 text-gray-800 dark:text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M17.25 9.75 19.5 12m0 0 2.25 2.25M19.5 12l2.25-2.25M19.5 12l-2.25 2.25m-10.5-6 4.72-4.72a.75.75 0 0 1 1.28.53v15.88a.75.75 0 0 1-1.28.53l-4.72-4.72H4.51c-.88 0-1.704-.507-1.938-1.354A9.009 9.009 0 0 1 2.25 12c0-.83.112-1.633.322-2.396C2.806 8.756 3.63 8.25 4.51 8.25H6.75Z" />
              </svg>
              <svg data-video-hover-target="unmutedIcon" class="w-6 h-6 text-gray-800 dark:text-white hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M19.114 5.636a9 9 0 0 1 0 12.728M16.463 8.288a5.25 5.25 0 0 1 0 7.424M6.75 8.25l4.72-4.72a.75.75 0 0 1 1.28.53v15.88a.75.75 0 0 1-1.28.53l-4.72-4.72H4.51c-.88 0-1.704-.507-1.938-1.354A9.009 9.009 0 0 1 2.25 12c0-.83.112-1.633.322-2.396C2.806 8.756 3.63 8.25 4.51 8.25H6.75Z" />
              </svg>
            </button>
          </div>
        <% end %>
        <!-- Animated chapter names background -->
        <% if tutorial.chapters.any? %>
          <div class="absolute inset-0 overflow-hidden opacity-20 group-hover:opacity-0 transition-opacity duration-300">
            <%
                  chapter_names = tutorial.chapters.pluck(:name).uniq
                  total_duration = chapter_names.length * 3
                %>
            <% chapter_names.each_with_index do |name, index| %>
              <div class="absolute text-white font-semibold text-center opacity-0"
                       style="animation: fade-in-out <%= total_duration %>s ease-in-out infinite; animation-delay: <%= index * 3 %>s; font-size: <%= 14 + (index * 7) % 12 %>px; top: <%= 20 + (index * 37) % 60 %>%; left: <%= 10 + (index * 43) % 80 %>%; transform: translate(-50%, -50%);">
                <%= name %>
              </div>
            <% end %>
          </div>
        <% end %>
        <!-- Tutorial name (above background) -->
        <div class="relative z-10 group-hover:opacity-0 transition-opacity duration-300">
          <h3 class="text-white font-bold text-center text-base md:text-xl px-4 glow-pulse-text">
            <%= tutorial.name %>
          </h3>
        </div>
      </div>
      <!-- Summary Section -->
      <div class="p-3 md:p-4 bg-gray-50 dark:bg-gray-800">
        <div class="space-y-0.5 md:space-y-1 text-xs md:text-sm text-gray-600 dark:text-gray-400">
          <div class="flex items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9.568 3H5.25A2.25 2.25 0 0 0 3 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 0 0 5.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 0 0 9.568 3Z" />
              <path stroke-linecap="round" stroke-linejoin="round" d="M6 6h.008v.008H6V6Z" />
            </svg>
            <% if tutorial.skill_category.present? %>
              <span><%= tutorial.skill_category.name %></span>
            <% end %>
          </div>
          <div class="flex items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 0 0 6 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 0 1 6 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 0 1 6-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0 0 18 18a8.967 8.967 0 0 0-6 2.292m0-14.25v14.25" />
            </svg>
            <span><%= pluralize(tutorial.chapters.count, 'clip') %></span>
          </div>
        </div>
      </div>
    </div>
  <% end %>
<% end %>