<% cache lesson do %>
  <tr id="<%= sortable_id %>" data-lesson-id="<%= lesson.id %>" data-lesson-highlight-target="row">
    <td class="text-left md:px-3 py-2 border-b border-gray-300 dark:border-gray-600 dark:text-gray-200">
      <div class="flex items-center gap-2">
        <% if lesson.teacher.present? %>
          <% if lesson.teacher.display_avatar(size: 24) %>
            <div class="min-w-6 min-h-6">
              <%= image_tag lesson.teacher.display_avatar(size: 24), alt: lesson.teacher.name, class: "w-6 h-6 rounded-full object-cover border border-gray-200 dark:border-gray-700" %>
            </div>
          <% else %>
            <div class=" rounded-full min-w-6 min-h-6 bg-gradient-to-br from-blue-400 to-purple-500 flex items-center justify-center">
              <span class="text-white text-xs"><%= lesson.teacher.initials&.upcase %></span>
            </div>
          <% end %>
        <% end %>
        <span id="lesson_<%= lesson.id %>_name_in_table">
          <%= link_to lesson.name, lesson, class:"text-blue-500 hover:text-red-500 dark:text-blue-400 dark:hover:text-red-400" %>
        </span>
      </div>
    </td>
    <td class="text-left md:px-3 py-2 border-b border-gray-300 dark:border-gray-600 dark:text-gray-200">
      <span id="lesson_<%= lesson.id %>_date"
                    data-controller="inline-edit"
                    data-inline-edit-url-value="<%= lesson_path(lesson) %>"
                    data-inline-edit-field-value="date"
                    class="inline-block">
        <span data-inline-edit-target="display"
                      data-action="click->inline-edit#edit"
          class="cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 px-1 rounded items-center gap-1">
          <%= lesson.date.strftime("%b %d, %Y") %>
        </span>
        <%= form_with(model: lesson, url: lesson_path(lesson), data:{ inline_edit_target: 'form', turbo_frame: '_top', turbo_stream: true}) do |form| %>
          <input type="hidden" name="return_url" value="<%= request.fullpath %>">
          <input data-inline-edit-target="input"
                      name="lesson[date]"
                       type="date"
                       value="<%= lesson.date %>"
                       data-action="keydown->inline-edit#save blur->inline-edit#blur"
          class="hidden border border-gray-300 dark:border-gray-600 rounded px-2 py-1 dark:bg-gray-800 dark:text-gray-200" />
        <% end %>
      </span>
    </td>
    <td class="text-right md:px-3 py-2 border-b border-gray-300 dark:border-gray-600 dark:text-gray-200">
      <%= lesson.chapters.count %>
      <span class="inline-flex items-center gap-2">
        <% if lesson.complete? %>
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-2.5 h-2.5 text-green-500 dark:text-green-400 flex-shrink-0">
            <path fill-rule="evenodd" d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12zm13.36-1.814a.75.75 0 10-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 00-1.06 1.06l2.25 2.25a.75.75 0 001.14-.094l3.75-5.25z" clip-rule="evenodd" />
          </svg>
        <% else %>
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-2.5 h-2.5 text-gray-400 dark:text-gray-500 flex-shrink-0">
            <path fill-rule="evenodd" d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25z" clip-rule="evenodd" />
          </svg>
        <% end %>
      </span>
    </td>
  </tr>
<% end %>